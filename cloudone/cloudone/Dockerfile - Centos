FROM    centos:centos6

# EPEL repository
RUN rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

# Install wget
RUN yum install -y wget

# Install docker 
RUN wget -qO- https://get.docker.com/ | sh

# Install git
RUN yum install -y git

# Install python
RUN yum install -y python

# Download pip
RUN yum install -y python-pip

# Install python httplib2
RUN pip install httplib2

# Glusterfs repository
RUN wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo
# Install glusterfs
RUN yum install -y glusterfs-server

# Bundle app source
COPY . /src

# Copy configuration
RUN mkdir -p /etc/cloudone
RUN mkdir -p /var/log/cloudone
RUN cp /src/cloudone/configuration/* /etc/cloudone/

# Priviledge
RUN chmod a+x /src/run.sh
RUN chmod a+x /src/cloudone/cloudone

EXPOSE  8081
CMD ["/src/run.sh"]
